{% extends "base.html" %} {% block title %}{{ app_name }} - Status{% endblock %} {% block styles %}
<style>
  .status-section {
    background: white;
    border-radius: 15px;
    padding: 30px 20px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
  }

  .status-section h3 {
    font-size: 22px;
    font-weight: bold;
    margin-bottom: 20px;
    color: #4f46e5;
  }

  .status-card {
    background: #f9fafb;
    border: 1px solid #e5e7eb;
    border-radius: 10px;
    padding: 15px 20px;
    margin-bottom: 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .status-card strong {
    color: #1f2937;
  }

  .status-indicator {
    display: inline-block;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    margin-right: 8px;
  }

  .status-ok {
    background: #10b981;
  }

  .status-warning {
    background: #f59e0b;
  }

  .status-error {
    background: #ef4444;
  }

  .refresh-btn {
    background: #4f46e5;
    color: white;
    padding: 8px 15px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    font-size: 14px;
    font-weight: bold;
    transition: all 0.3s ease;
  }

  .refresh-btn:hover {
    background: #4338ca;
  }

  .last-update {
    font-size: 13px;
    color: #6b7280;
    margin-top: 5px;
  }
</style>
{% endblock %} {% block content %}
<div class="status-section">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3><i class="fas fa-heartbeat me-2"></i>Status Layanan</h3>
    <button class="refresh-btn" onclick="fetchStatus()"><i class="fas fa-sync-alt me-1"></i>Perbarui</button>
  </div>

  <div id="statusCards">
    <div class="text-center my-4">
      <i class="fas fa-spinner fa-spin fa-2x text-secondary"></i>
      <p class="text-secondary mt-2">Memuat status layanan...</p>
    </div>
  </div>

  <div class="last-update" id="lastUpdate">Terakhir diperbarui: -</div>
</div>

{% endblock %} {% block scripts %}
<script>
  async function fetchStatus() {
    const statusContainer = document.getElementById("statusCards");
    const lastUpdate = document.getElementById("lastUpdate");

    statusContainer.innerHTML = `
      <div class="text-center my-4">
        <i class="fas fa-spinner fa-spin fa-2x text-secondary"></i>
        <p class="text-secondary mt-2">Memuat status layanan...</p>
      </div>`;

    try {
      const response = await fetch("/api/v1/chat/status");
      const data = await response.json();

      if (data.status !== "ready") {
        statusContainer.innerHTML = `
          <div class="status-card">
            <strong>Chat Pipeline</strong>
            <span><span class="status-indicator status-warning"></span>Not Ready</span>
          </div>`;
      } else {
        const services = data.services || {};
        let cards = "";

        for (const [service, status] of Object.entries(services)) {
          let indicatorClass = status === "loaded" ? "status-ok" : status === "warning" ? "status-warning" : "status-error";
          let statusText = status.charAt(0).toUpperCase() + status.slice(1).replace("_", " ");

          cards += `
            <div class="status-card">
              <strong>${service.replace("_", " ")}</strong>
              <span><span class="status-indicator ${indicatorClass}"></span>${statusText}</span>
            </div>`;
        }

        cards += `
          <div class="status-card">
            <strong>Templates Loaded</strong>
            <span>${data.templates_loaded} template</span>
          </div>
          <div class="status-card">
            <strong>Active Contexts</strong>
            <span>${data.active_contexts}</span>
          </div>`;

        statusContainer.innerHTML = cards;
      }

      lastUpdate.textContent = `Terakhir diperbarui: ${new Date().toLocaleString("id-ID")}`;
    } catch (error) {
      console.error("Error fetching status:", error);
      statusContainer.innerHTML = `
        <div class="status-card">
          <strong>Error</strong>
          <span><span class="status-indicator status-error"></span>Gagal memuat status</span>
        </div>`;
    }
  }

  document.addEventListener("DOMContentLoaded", fetchStatus);
</script>
{% endblock %}
